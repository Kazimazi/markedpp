/*!
 * Markdown Preprocessor
 *
 * @copyright 2014 commenthol
 * @licence MIT
 *
 * @note Code inspired by `marked` project
 * @credits Christopher Jeffrey <https://github.com/chjj/marked>
 */
(function(e){"use strict";var t={gfm:true,breaks:true,tags:true,level:3,minlevel:1};function n(){return typeof process!=="undefined"&&typeof module!=="undefined"&&module.exports}function i(e,t){e=e.source;t=t||"";return function n(i,r){if(!i)return new RegExp(e,t);r=r.source||r;r=r.replace(/(^|[^\[])\^/g,"$1");e=e.replace(i,r);return n}}function r(){}r.exec=r;function s(e){var t=1,n,i;for(;t<arguments.length;t++){n=arguments[t];for(i in n){if(Object.prototype.hasOwnProperty.call(n,i)){e[i]=n[i]}}}return e}var o={normalizeArray:function(e,t){var n=0;for(var i=e.length-1;i>=0;i--){var r=e[i];if(r==="."){e.splice(i,1)}else if(r===".."){e.splice(i,1);n++}else if(n){e.splice(i,1);n--}}if(t){for(;n--;n){e.unshift("..")}}return e},resolve:function(){var e="",t=false;for(var n=arguments.length-1;n>=-1&&!t;n--){var i=n>=0?arguments[n]:"/";if(!i){continue}e=i+"/"+e;t=i.charAt(0)==="/"}e=this.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/");return(t?"/":"")+e||"."},splitPathRe:/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath:function(e){return this.splitPathRe.exec(e).slice(1)},dirname:function(e){var t=this.splitPath(e),n=t[0],i=t[1];if(!n&&!i){return"."}if(i){i=i.substr(0,i.length-1)}return n+i},join:function(){return Array.prototype.slice.call(arguments).join("/")}};var p={_eachLimit:function(e){return function(t,n,i){i=i||function(){};if(!t.length||e<=0){return i()}var r=0;var s=0;var o=0;(function p(){if(r>=t.length){return i()}while(o<e&&s<t.length){s+=1;o+=1;n(t[s-1],function(e){if(e){i(e);i=function(){}}else{r+=1;o-=1;if(r>=t.length){i()}else{p()}}})}})()}},eachLimit:function(e,t,n,i){var r=this._eachLimit(t);r.apply(null,[e,n,i])}};function u(e,t,n){if(typeof t==="function"){n=t;t=null}var i=t?t:{};var r=this,s=new XMLHttpRequest,o=i.method||"get",p=typeof i.async!=="undefined"?i.async:true,u=i.data||null,f;s.queryString=u;s.open(o,e,p);s.setRequestHeader("X-Requested-With","XMLHttpRequest");if(o.toLowerCase()=="post"){s.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}for(f in i.headers){if(i.headers.hasOwnProperty(f)){s.setRequestHeader(f,i.headers[f])}}function l(){if(s.readyState===4){if(/^[20]/.test(s.status)){n(null,s.responseText)}else if(/^[45]/.test(s.status)){n(new Error(s.status))}}}if(p){s.onreadystatechange=l}s.send(u);if(!p)l()}var f;if(n()){f=require("./ppinclude")(a,s)}else{f=function(e,t,n){var i=t.dirname||"/",r={},l=s({},t);if(!l.ppInclude){l.ppInclude={}}p.eachLimit(e,5,function(e,t){if(e.type==="ppinclude"&&typeof e.text==="string"&&!l.ppInclude[e.text]){var n=o.resolve(o.join(o.dirname(location.pathname),i,e.text));var s=location.origin+n;u(s,function(i,s){l.ppInclude[e.text]=1;l.dirname=o.dirname(n);if(i){console.error("Error: "+i.message);return t()}var p=new a(l);f(p.lex(s),l,function(n,i){r[e.text]=i;t()})})}else{t()}},function(t){var i=[];e.forEach(function(e,t){if(e.type==="ppinclude"&&typeof e.text==="string"&&r[e.text]!==undefined){i.push({type:"ppinclude.start",text:e.text,indent:e.indent,lang:e.lang});r[e.text].forEach(function(e){i.push(s({},e))});i.push({type:"ppinclude.end",lang:e.lang})}else{i.push(e)}});n(null,i)})}}var l={heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,fences:r,_ppopts_:/ ?(?:\(([^\)]+)\))?/,ppinclude:/^( *)(?:\!(?:INCLUDE|include)_ppopts_|_ppinclude_|_ppincludeCompat_) *(?:\n|$)/,_ppinclude_:/<!-- *include_ppopts_ *-->(?:(?!<!-- *\/include * -->)[^])*<!-- *\/include * -->/,_ppincludeCompat_:/\!INCLUDE "([^"]+)"/,ppnumberedheadings:/^ *(?:\!(?:NUMBEREDHEADINGS|numberedheadings)_ppopts_|_ppnumberedheadings_) *(?:\n+|$)/,_ppnumberedheadings_:/<!-- \!*numberedheadings_ppopts_ *-->/,pptoc:/^(?:\!(?:TOC|toc)_ppopts_|_pptoc_|_pptocCompat1_|_pptocCompat2_) *(?:\n+|$)/,_pptoc_:/<!-- *\!toc_ppopts_ *-->(?:(?!<!-- *toc\! * -->)[^])*<!-- *toc\! * -->/,_pptocCompat1_:/<!-- *toc *-->(?:(?!<!-- *\/toc * -->)[^])*<!-- *\/toc * -->/,_pptocCompat2_:/<!-- *toc *-->/,ppref:/^(?:\!(?:REF|ref)|_ppref_|_pprefCompat_) *(?:\n|$)/,_ppref_:/<!-- *\!ref *-->(?:(?!<!-- *ref\! * -->)[^])*<!-- *ref\! * -->/,_pprefCompat_:/<!-- *ref *-->(?:(?!<!-- *\/ref * -->)[^])*<!-- \/ref * -->/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n|$)/,text:/^[^\n]*\n/};l.ppinclude=i(l.ppinclude)("_ppinclude_",l._ppinclude_)("_ppincludeCompat_",l._ppincludeCompat_)("_ppopts_",l._ppopts_)("_ppopts_",l._ppopts_)();l.ppnumberedheadings=i(l.ppnumberedheadings)("_ppnumberedheadings_",l._ppnumberedheadings_)("_ppopts_",l._ppopts_)("_ppopts_",l._ppopts_)();l.pptoc=i(l.pptoc)("_pptoc_",l._pptoc_)("_ppopts_",l._ppopts_)("_ppopts_",l._ppopts_)("_pptocCompat1_",l._pptocCompat1_)("_pptocCompat2_",l._pptocCompat2_)();l.ppref=i(l.ppref)("_ppref_",l._ppref_)("_pprefCompat_",l._pprefCompat_)();l.gfm=s({},l,{fences:/^( *)(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\2 *(?:\n|$)/});function a(e){this.tokens=[];this.options=e||t;this.rules=l;if(this.options.gfm){this.rules=l.gfm}}a.prototype.lex=function(e){e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(e,true)};a.prototype.token=function(e){var n,i,r,s=this;e=e.replace(/^ +$/gm,"");while(e){if(n=this.rules.fences.exec(e)){e=e.substring(n[0].length);this.tokens.push({type:"code",indent:n[1],fences:n[2],lang:n[3],text:n[4]});continue}if(n=this.rules.heading.exec(e)){e=e.substring(n[0].length);this.tokens.push({type:"heading",depth:n[1].length,text:n[2],raw:n[2]});continue}if(n=this.rules.lheading.exec(e)){e=e.substring(n[0].length);this.tokens.push({type:"heading",depth:n[2]==="="?1:2,text:n[1],raw:n[1]});continue}if(n=this.rules.ppnumberedheadings.exec(e)){e=e.substring(n[0].length);r=a.splitOpts(n[1]||n[2]);if(typeof r.omit==="string"){r.omit=[r.omit]}this.tokens.push({type:"ppnumberedheadings",level:a.range(r.level,t.minlevel,6,t.level),minlevel:a.range(r.minlevel,t.minlevel,6),skip:r.skip,start:r.start,omit:r.omit});continue}if(n=this.rules.pptoc.exec(e)){e=e.substring(n[0].length);r=a.splitOpts(n[1]||n[2]);if(typeof r.omit==="string"){r.omit=[r.omit]}this.tokens.push({type:"pptoc",level:a.range(r.level,t.minlevel,6,t.level),minlevel:a.range(r.minlevel,t.minlevel,6),numbered:r.numbered,omit:r.omit});continue}if(n=this.rules.ppinclude.exec(e)){e=e.substring(n[0].length);i=n[2]||n[3]||n[4];r=a.splitOpts(i);i=i.replace(/ *(?:[a-z]+=[a-z0-9\-]+)/,"").replace(/\\ /g," ");this.tokens.push({type:"ppinclude",text:i,indent:n[1],lang:r.lang});continue}if(n=this.rules.ppref.exec(e)){e=e.substring(n[0].length);this.tokens.push({type:"ppref"});continue}if(n=this.rules.def.exec(e)){e=e.substring(n[0].length);this.tokens.push({type:"def",ref:n[1],href:n[2],title:n[3]});continue}if(n=this.rules.text.exec(e)){e=e.substring(n[0].length);this.tokens.push({type:"text",text:n[0]});continue}if(e){throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}}return this.tokens};a.rules=l;a.lex=function(e,t,n){var i=new a(t);var r=i.lex(e);f(r,t,function(e,t){n(e,t)})};a.splitOpts=function(e){var t={},n,i="",r=/^(.+)$/,s=/^([a-z0-9]+)=(.*)$/,o=/^([a-z0-9]+)=(["'])(.*?)\2$/;(e||"").split(" ").forEach(function(e){if(/\\$|^["'].*[^"']$/.test(e)||n&&!n.test(e)){i+=e+" ";return}if(/\=(["']).*[^"']$/.test(e)){n=e.replace(/^.*\=(["']).*[^"']$/,"$1");n=new RegExp(n+"$");i+=e+" ";return}if(i){e=i+e;i="";n=undefined}if(o.test(e)){e.replace(o,function(e,n,i,r){t[n]=r.split(";");t[n]=t[n].map(function(e){var t=parseInt(e,10);if(!isNaN(t)){e=t}return e});if(t[n].length===1){t[n]=t[n][0]}})}else if(s.test(e)){e.replace(s,function(e,n,i){var r=parseInt(i,10);if(!isNaN(r)){i=r}t[n]=i})}else if(r.test(e)){e=e.replace(/\\ /g," ").replace(/^(["'])([^\1]+)\1$/,"$2");if(/^\!(.*)$/.test(e)){e=e.replace(/^\!(.*)$/,"$1");t[e]=false}else{t[e]=true}}});return t};a.range=function(e,t,n,i){if(e<t){return t}else if(e>n){return n}else{if(i&&e===i){return undefined}return e}};function c(e){this._=[0,0,0,0,0,0,0];this.last=1;this._[1]=e?e-1:0}c.prototype.reset=function(e){for(var t=e+1;t<this._.length;t++){this._[t]=0}};c.prototype.val=function(e){var t,n=this._[1];for(t=2;t<=e;t++){n+="."+this._[t]}return n+"\\."};c.prototype.count=function(e){if(e<=6){if(this.last>e){this.reset(e)}this._[e]+=1;this.last=e;return this.val(e)}return};function h(e){this.options=e||{};this._indent=""}h.prototype.heading=function(e,t,n,i){var r="########".substring(0,t);return this._indent+r+" "+e+"\n\n"};h.prototype.paragraph=function(e){return this._indent+e};h.prototype.code=function(e,t,n,i){return this.fences(t,n,i)+e+"\n"+this.fences("",n,i)};h.prototype.reference=function(e,t,n){return this._indent+"["+e+"]: "+t+(n?' "'+n+'"':"")+"\n"};h.prototype.include=function(e,t,n){return this._indent+t+"!include ("+e+(n?" lang="+n:"")+")\n"};h.prototype.fences=function(e,t,n){n=n||"```";t=t||"";return this._indent+t+n+(e?e:"")+"\n"};h.prototype.indent=function(e){this._indent=e};h.sortByTitle=function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();if(n>i){return 1}else if(n<i){return-1}else{return 0}};h.prototype.referenceId=function(e){return e.toLowerCase().replace(/[^\w]+/g,"-")};h.prototype.references=function(e){var t=[];e.map(function(e){if(!e.title){e.title=e.ref}return e}).sort(h.sortByTitle).forEach(function(e){t.push("* ["+e.title+"]["+e.ref+"]")});if(this.options.tags){return"<!-- !ref -->\n\n"+t.join("\n")+"\n\n<!-- ref! -->\n"}else{return t.join("\n")+"\n"}};h.prototype.tableOfContents=function(e,n){var i=this,r,s,o=[],p=this.joinOpts({level:n.level,minlevel:n.minlevel,numbered:n.numbered,omit:n.omit}),u=new c,f=this.options.breaks?" <br>":"",l=n.level||t.level,a=n.minlevel||t.minlevel;o=e.filter(function(e){if(e.depth<=l&&e.depth>=a){return true}return false}).map(function(e){if(!i.options.numberedHeadings&&n.numbered){e.number=u.count(e.depth-a+1)}return e}).filter(function(e){if(n.omit){if(s){if(e.depth>s){return false}else{s=undefined}}return!n.omit.some(function(t){if(t===e.raw){s=e.depth;return true}return false})}return true}).map(function(e){if(n.numbered){if(i.options.numberedHeadings){return(e.number?e.number+" ":"")+"["+i.removeLinkFromHeadings(e.raw)+"](#"+i.referenceId(e.text)+")"+f}else{return e.number+" ["+i.removeLinkFromHeadings(e.text)+"](#"+i.referenceId(e.text)+")"+f}}else{var t="";for(var r=1;r<(e.depth-a+1||1);r++){t+="  "}return t+"* ["+i.removeLinkFromHeadings(e.text)+"](#"+i.referenceId(e.text)+")"}});if(this.options.tags){return"<!-- !toc "+p+"-->\n\n"+o.join("\n")+"\n\n<!-- toc! -->\n\n"}else{return o.join("\n")+"\n\n"}};h.prototype.numberedHeadings=function(e,t,n,i,r){var s=this.joinOpts({level:e,minlevel:t,skip:n,start:i,omit:r});if(this.options.tags){return"<!-- !numberedheadings "+s+"-->\n\n"}return""};h.prototype.joinOpts=function(e){var t,n,i=[];for(t in e){n=e[t];if(n===true){i.push(t)}else if(n!==undefined){if(Array.isArray(n)){n='"'+n.join(";")+'"'}i.push(t+"="+n)}}if(i.length>0){return"("+i.join(" ")+") "}else{return""}};h.prototype.removeLinkFromHeadings=function(e){return e.replace(/\[([^\]]*)\]\s*(?:\[[^\]]*\]|\([^\)]*\))/g,"$1")};function d(e){this.tokens=[];this.token=null;this.count=-1;this.indent=[];this.options=e||t;this.options.renderer=this.options.renderer||new h;this.renderer=this.options.renderer;this.renderer.options=this.options}d.prototype.parse=function(e){this.tokens=e;var t="";while(this.next()){t+=this.tok()}return t};d.prototype.next=function(){this.token=this.tokens[this.count+=1];return this.token};d.prototype.peek=function(){return this.tokens[this.count+1]||0};d.prototype.references=function(){var e,t=[],n={title:{},ref:{}};this.tokens.forEach(function(e){if(e.type==="def"&&!/^#/.test(e.href)){if(e.title){n.title[e.ref]=e.title}else{n.ref[e.ref]=e.ref}}});for(e in n.title){t.push({ref:e,title:n.title[e]})}for(e in n.ref){if(!n.title[e]){t.push({ref:e,title:e})}}return t};d.prototype.tableOfContents=function(){return this.tokens.filter(function(e){if(e.type==="heading"){return true}return false})};d.prototype.numberedHeadings=function(e,n,i,r,s){var o=/^([0-9]+\\?\.)+ +/,p={},u=false,f=new c(r);i=i||0;(s||[]).forEach(function(e){p[e]=true});e=e||t.level;n=n||t.minlevel;this.tokens=this.tokens.map(function(t){if(t.type==="heading"){t.text=t.text.replace(o,"");t.raw=t.raw.replace(o,"");if(t.depth===n){if(i>0){i-=1;u=true}else if(i===0){u=false}}if(!u&&!p[t.raw]&&t.depth<=e&&t.depth>=n){t.number=f.count(t.depth-n+1);t.text=t.number+" "+t.text}}return t})};d.prototype.tok=function(){var e="";switch(this.token.type){case"heading":{return this.renderer.heading(this.token.text,this.token.depth,this.token.raw,this.token.number)}case"text":{return this.renderer.paragraph(this.token.text)}case"code":{return this.renderer.code(this.token.text,this.token.lang,this.token.indent,this.token.fences)}case"def":{return this.renderer.reference(this.token.ref,this.token.href,this.token.title)}case"ppnumberedheadings":{this.options.numberedHeadings=true;this.numberedHeadings(this.token.level,this.token.minlevel,this.token.skip,this.token.start,this.token.omit);return this.renderer.numberedHeadings(this.token.level,this.token.minlevel,this.token.skip,this.token.start,this.token.omit)}case"ppref":{return this.renderer.references(this.references())}case"ppinclude.start":{this.indent.push(this.token.indent);this.renderer.indent(this.indent.join(""));if(typeof this.token.lang==="string"){e=this.renderer.fences(this.token.lang)}return e}case"ppinclude.end":{if(typeof this.token.lang==="string"){e=this.renderer.fences()}this.indent.pop();this.renderer.indent(this.indent.join(""));return e}case"ppinclude":{return this.renderer.include(this.token.text,this.token.indent,this.token.lang)}case"pptoc":{return this.renderer.tableOfContents(this.tableOfContents(),this.token)}default:{return"<!-- "+JSON.stringify(this.token)+" -->\n"}}};d.parse=function(e,t){var n=new d(t);return n.parse(e)};function m(e,n,i){if(typeof n==="function"){i=n;n=null}n=s({},t,n||{});a.lex(e,n,function(e,t){var r=d.parse(t,n);i(null,r)})}m.defaults=t;m.Lexer=a;m.merge=s;m.setOptions=function(e){s(t,e);return m};if(n()){module.exports=m}else if(typeof define!=="undefined"&&define.amd){define([],function(){return m})}else if(typeof e.Window!=="undefined"&&!e[m]){e.markedpp=m}})(this);